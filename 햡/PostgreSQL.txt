DROP TABLE IF EXISTS USERS CASCADE;
DROP TABLE IF EXISTS CHAT_ROOM CASCADE;
DROP TABLE IF EXISTS CHAT_MSG CASCADE;

CREATE TABLE IF NOT EXISTS USERS
(
	USER_ID SERIAL PRIMARY KEY,
	USERNAME VARCHAR(50) NOT NULL,
	PASSWORD VARCHAR(50) NOT NULL,
	CREATED_ON TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	LAST_LOGIN TIMESTAMP
);
CREATE TABLE IF NOT EXISTS CHAT_ROOM
(
	CHAT_ID SERIAL PRIMARY KEY,
	USER_ID INT NOT NULL,
	CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE ON UPDATE CASCADE

);

CREATE TABLE IF NOT EXISTS CHAT_MSG
(
	MSG_ID SERIAL PRIMARY KEY,
	MSG VARCHAR(50) NOT NULL,
	MSG_READ BOOLEAN NOT NULL DEFAULT FALSE,
	USER_ID INT NOT NULL,
	CHAT_ID INT NOT NULL,
	CREATED_ON TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_chat_room FOREIGN KEY (chat_id) REFERENCES chat_room(chat_id) ON DELETE CASCADE ON UPDATE CASCADE
);


INSERT INTO USERS (USERNAME, PASSWORD, CREATED_ON, LAST_LOGIN) 
VALUES 
('john_doe', 'password123', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
('jane_smith', 'securePass456', CURRENT_TIMESTAMP, NULL),
('alice_wonder', 'wonderland', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO CHAT_ROOM (USER_ID)
VALUES 
(1), -- john_doe가 생성한 채팅방
(2), -- jane_smith가 생성한 채팅방
(3); -- alice_wonder가 생성한 채팅방

INSERT INTO CHAT_MSG (MSG, MSG_READ, USER_ID, CHAT_ID, CREATED_ON)
VALUES 
('Hello, everyone!', FALSE, 1, 1, CURRENT_TIMESTAMP), -- john_doe의 메시지
('Hi John!', TRUE, 2, 1, CURRENT_TIMESTAMP), -- jane_smith의 메시지
('Good morning!', FALSE, 3, 2, CURRENT_TIMESTAMP), -- alice_wonder의 메시지
('How are you?', FALSE, 1, 2, CURRENT_TIMESTAMP); -- john_doe가 alice의 채팅방에 보낸 메시지
